{% extends "base_account.html" %}
{% load static %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞–Ω–∞–º–∏ –Ω–∞—Ä—è–¥–æ–≤{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/commandant_duty_plan.css' %}">
<style>
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ */
.dashboard-header {
    background: linear-gradient(135deg, #2d2d30 0%, #252526 100%);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    border-left: 6px solid #4ec9b0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    border: 1px solid #3e3e42;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.header-content h1 {
    margin: 0 0 10px 0;
    color: #ffffff;
    font-size: 2.4rem;
    font-weight: 700;
}

.header-subtitle {
    color: #4ec9b0;
    font-size: 1.1rem;
    margin: 0;
}

/* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.quick-action-card {
    background: linear-gradient(135deg, #252526 0%, #2d2d30 100%);
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    border: 1px solid #3e3e42;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.quick-action-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #4ec9b0, #569cd6);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.quick-action-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    border-color: #4ec9b0;
}

.quick-action-card:hover::before {
    transform: scaleX(1);
}

.action-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: #4ec9b0;
}

.action-title {
    color: #ffffff;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.action-description {
    color: #888;
    font-size: 0.9rem;
    line-height: 1.4;
}

/* –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –ø–ª–∞–Ω–æ–≤ */
.timeline-section {
    background: linear-gradient(135deg, #252526 0%, #2d2d30 100%);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid #3e3e42;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 15px;
}

.section-title {
    margin: 0;
    color: #ffffff;
    font-size: 1.6rem;
    display: flex;
    align-items: center;
    gap: 12px;
}

.timeline {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.timeline-item {
    background: #2d2d30;
    border-radius: 12px;
    padding: 20px;
    border-left: 4px solid #007acc;
    transition: all 0.3s ease;
    border: 1px solid #3e3e42;
    display: flex;
    justify-content: between;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.timeline-item:hover {
    transform: translateX(5px);
    border-left-color: #4ec9b0;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.timeline-content {
    flex: 1;
    min-width: 300px;
}

.timeline-month {
    color: #4ec9b0;
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.timeline-meta {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 10px;
}

.meta-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: rgba(78, 201, 176, 0.1);
    border-radius: 15px;
    font-size: 0.85rem;
    color: #4ec9b0;
    border: 1px solid rgba(78, 201, 176, 0.3);
}

.timeline-duties {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 10px;
}

.duty-pill {
    background: rgba(86, 156, 214, 0.1);
    color: #569cd6;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.8rem;
    border: 1px solid rgba(86, 156, 214, 0.3);
}

.timeline-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, #252526 0%, #2d2d30 100%);
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #3e3e42;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #4ec9b0, #569cd6);
}

.stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.stat-title {
    color: #888;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.stat-icon {
    font-size: 1.5rem;
    color: #4ec9b0;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 5px;
}

.stat-change {
    font-size: 0.85rem;
    color: #4ec9b0;
}

.stat-change.negative {
    color: #f44747;
}

/* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.empty-dashboard {
    text-align: center;
    padding: 80px 30px;
    background: linear-gradient(135deg, #252526 0%, #2d2d30 100%);
    border-radius: 16px;
    border: 1px solid #3e3e42;
}

.empty-icon {
    font-size: 4rem;
    color: #4ec9b0;
    margin-bottom: 20px;
    opacity: 0.7;
}

.empty-title {
    color: #ffffff;
    font-size: 1.8rem;
    margin-bottom: 15px;
}

.empty-description {
    color: #888;
    font-size: 1.1rem;
    margin-bottom: 30px;
    line-height: 1.6;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .dashboard-header {
        flex-direction: column;
        text-align: center;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
    
    .timeline-item {
        flex-direction: column;
        align-items: stretch;
    }
    
    .timeline-actions {
        justify-content: center;
    }
    
    .stats-overview {
        grid-template-columns: 1fr;
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.timeline-item, .stat-card, .quick-action-card {
    animation: slideInUp 0.6s ease-out;
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
.btn-create {
    background: linear-gradient(135deg, #4ec9b0 0%, #3aa794 100%);
    color: #1e1e1e;
    border: none;
    padding: 12px 24px;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-create:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(78, 201, 176, 0.4);
    color: #1e1e1e;
}

.btn-view {
    background: rgba(86, 156, 214, 0.1);
    color: #569cd6;
    border: 1px solid rgba(86, 156, 214, 0.3);
    padding: 8px 16px;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-view:hover {
    background: #569cd6;
    color: white;
    transform: translateY(-1px);
}

.btn-edit {
    background: rgba(215, 186, 125, 0.1);
    color: #d7ba7d;
    border: 1px solid rgba(215, 186, 125, 0.3);
    padding: 8px 16px;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.btn-edit:hover {
    background: #d7ba7d;
    color: #1e1e1e;
    transform: translateY(-1px);
}
</style>
{% endblock %}

{% block account_content %}
<div class="dashboard-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ -->
    <div class="dashboard-header">
        <div class="header-content">
            <h1>üéØ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞–Ω–∞–º–∏</h1>
            <p class="header-subtitle">–¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –Ω–∞—Ä—è–¥–æ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</p>
        </div>
        <a href="{% url 'commandant:duty_plan' %}" class="btn btn-create">
            <i class="fas fa-plus"></i> –ù–æ–≤—ã–π –ø–ª–∞–Ω
        </a>
    </div>

    {% if plans %}
    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="quick-actions">
        <div class="quick-action-card" onclick="location.href='{% url 'commandant:duty_plan' %}'">
            <div class="action-icon">üìÖ</div>
            <div class="action-title">–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω</div>
            <div class="action-description">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Ä—è–¥–æ–≤</div>
        </div>
        
        <div class="quick-action-card" onclick="location.href='{% url 'commandant:plan_list' %}'">
            <div class="action-icon">üìä</div>
            <div class="action-title">–í—Å–µ –ø–ª–∞–Ω—ã</div>
            <div class="action-description">–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤</div>
        </div>
        
        <div class="quick-action-card" onclick="scrollToTimeline()">
            <div class="action-icon">‚è∞</div>
            <div class="action-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–Ω—ã</div>
            <div class="action-description">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–µ–∫—É—â–∏–º –≥—Ä–∞—Ñ–∏–∫–∞–º</div>
        </div>
        
        <div class="quick-action-card" onclick="location.href='{% url 'commandant:duty_plan' %}?year={% now 'Y' %}&month={% now 'n' %}'">
            <div class="action-icon">üöÄ</div>
            <div class="action-title">–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
            <div class="action-description">–†–∞–±–æ—Ç–∞ —Å –ø–ª–∞–Ω–æ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥</div>
        </div>
    </div>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">–í—Å–µ–≥–æ –ø–ª–∞–Ω–æ–≤</div>
                <div class="stat-icon">üìà</div>
            </div>
            <div class="stat-value">{{ plans.count }}</div>
            <div class="stat-change">+{{ active_plans_count }} –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–π</div>
                <div class="stat-icon">üéØ</div>
            </div>
            <div class="stat-value">{{ total_schedules }}</div>
            <div class="stat-change">–≤—Å–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">–ê–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Ä—è–¥–æ–≤</div>
                <div class="stat-icon">‚ö°</div>
            </div>
            <div class="stat-value">{{ total_duties }}</div>
            <div class="stat-change">–≤ —Å–∏—Å—Ç–µ–º–µ</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-title">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                <div class="stat-icon">üîÑ</div>
            </div>
            <div class="stat-value">{{ last_update|date:"d.m" }}</div>
            <div class="stat-change">{{ last_update|date:"H:i" }}</div>
        </div>
    </div>

    <!-- –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –ø–ª–∞–Ω–æ–≤ -->
    <div class="timeline-section" id="timeline">
        <div class="section-header">
            <h2 class="section-title">üìÖ –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –ø–ª–∞–Ω–æ–≤</h2>
            <div class="section-actions">
                <span class="text-muted">{{ plans.count }} –ø–ª–∞–Ω–æ–≤</span>
            </div>
        </div>

        <div class="timeline">
            {% for plan in plans %}
            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-month">
                        {{ plan.month|date:"F Y" }}
                        {% if plan.is_generated %}
                        <span style="color: #4ec9b0; font-size: 0.9rem;">‚úì</span>
                        {% else %}
                        <span style="color: #d7ba7d; font-size: 0.9rem;">‚úé</span>
                        {% endif %}
                    </div>
                    
                    <div class="timeline-meta">
                        <span class="meta-badge">
                            <i class="fas fa-tasks"></i>
                            {{ plan.duties.count }} –Ω–∞—Ä—è–¥–æ–≤
                        </span>
                        <span class="meta-badge">
                            <i class="fas fa-calendar-check"></i>
                            {% if plan.schedule_count %}
                                {{ plan.schedule_count }} –Ω–∞–∑–Ω–∞—á.
                            {% else %}
                                0 –Ω–∞–∑–Ω–∞—á.
                            {% endif %}
                        </span>
                        <span class="meta-badge">
                            <i class="fas fa-clock"></i>
                            {{ plan.created_at|date:"d.m.Y" }}
                        </span>
                    </div>

                    <div class="timeline-duties">
                        {% for duty in plan.duties.all|slice:":4" %}
                        <span class="duty-pill">{{ duty.duty_name }}</span>
                        {% endfor %}
                        {% if plan.duties.count > 4 %}
                        <span class="duty-pill">+{{ plan.duties.count|add:"-4" }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="timeline-actions">
                    <a href="{% url 'commandant:plan_detail' plan.pk %}" class="btn-view">
                        <i class="fas fa-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä
                    </a>
                    <a href="{% url 'commandant:duty_plan' %}?year={{ plan.month.year }}&month={{ plan.month.month }}" 
                       class="btn-edit">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
    <div style="text-align: center; margin-top: 30px;">
        <div class="btn-group">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-secondary">
                <i class="fas fa-chevron-left"></i> –ù–∞–∑–∞–¥
            </a>
            {% endif %}
            
            <span class="btn btn-outline-secondary" style="cursor: default;">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>
            
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn btn-secondary">
                –í–ø–µ—Ä–µ–¥ <i class="fas fa-chevron-right"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% else %}
    <!-- –ü—É—Å—Ç–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="empty-dashboard">
        <div class="empty-icon">üìä</div>
        <h2 class="empty-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É—Å—Ç–∞</h2>
        <p class="empty-description">
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –Ω–∞—Ä—è–¥–æ–≤.<br>
            –ù–∞—á–Ω–∏—Ç–µ —Å —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–ª–∞–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Ä—è–¥–æ–≤ –º–µ–∂–¥—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º–∏.
        </p>
        <a href="{% url 'commandant:duty_plan' %}" class="btn btn-create btn-lg">
            <i class="fas fa-rocket"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–ª–∞–Ω
        </a>
    </div>
    {% endif %}
</div>

<script>
function scrollToTimeline() {
    document.getElementById('timeline').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const items = document.querySelectorAll('.timeline-item, .stat-card, .quick-action-card');
    items.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.1}s`;
    });
});
</script>
{% endblock %}