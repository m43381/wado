{% extends "base_account.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}–ù–∞—Ä—è–¥—ã —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ ‚Ä¢ {{ faculty.name }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/faculty_academic_duties.css' %}">
{% endblock %}

{% block account_content %}
<div class="faculty-duties-container">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="duties-header">
        <div class="header-main">
            <h1>üìã –ù–∞—Ä—è–¥—ã —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ <span class="faculty-name">{{ faculty.name }}</span></h1>
            <p class="header-subtitle">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Ä—è–¥–æ–≤ –∫–æ–º–µ–Ω–¥–∞–Ω—Ç–∞ –Ω–∞ {{ current_date|date:"F Y" }}</p>
        </div>
        
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–µ–≤ -->
        <div class="month-switcher">
            <a href="?year={{ prev_month.year }}&month={{ prev_month.month }}" class="month-btn prev">
                ‚Üê {{ prev_month|date:"M" }}
            </a>
            <div class="current-month">
                <span class="month-name">{{ current_date|date:"F Y" }}</span>
            </div>
            <a href="?year={{ next_month.year }}&month={{ next_month.month }}" class="month-btn next">
                {{ next_month|date:"M" }} ‚Üí
            </a>
        </div>
    </div>
    
    {% if schedules %}
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="main-stats">
        <div class="stat-card total-duties">
            <div class="stat-icon">üìÖ</div>
            <div class="stat-content">
                <div class="stat-value">{{ total_duties }}</div>
                <div class="stat-label">–≤—Å–µ–≥–æ –Ω–∞—Ä—è–¥–æ–≤</div>
            </div>
        </div>
        
        <div class="stat-card days-count">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
                <div class="stat-value">{{ sorted_dates|length }}</div>
                <div class="stat-label">–¥–Ω–µ–π —Å –Ω–∞—Ä—è–¥–∞–º–∏</div>
            </div>
        </div>
    </div>
    
    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è -->
    <div class="distribution-table">
        <div class="table-header">
            <h2>üóìÔ∏è –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–Ω—è–º</h2>
        </div>
        
        <div class="table-container">
            <table class="duties-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ù–∞—Ä—è–¥—ã</th>
                    </tr>
                </thead>
                <tbody>
                    {% for date in sorted_dates %}
                    <tr class="{% if date == today %}today-row{% endif %}">
                        <td class="date-cell">
                            <div class="date-wrapper">
                                <span class="date-day">{{ date|date:"d" }}</span>
                                <span class="date-weekday">{{ date|date:"D" }}</span>
                            </div>
                        </td>
                        
                        <td class="combined-cell">
                            <div class="combined-list">
                                {% for schedule in schedules_by_date|get_item:date %}
                                <div class="combined-item">
                                    <div class="combined-header">
                                        <span class="duty-name">{{ schedule.duty.duty_name }}</span>
                                        <span class="duty-meta">
                                            <span class="people-count">{{ schedule.duty.people_count }} —á–µ–ª.</span>
                                        </span>
                                    </div>
                                    <div class="unit-info">
                                        {% if schedule.assigned_department %}
                                        üèõÔ∏è {{ schedule.assigned_department.name }}
                                        {% else %}
                                        üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ñ–µ–¥—Ä–∞–º -->
    <div class="department-distribution">
        <div class="section-header">
            <h2>üè¢ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º</h2>
        </div>
        
        <div class="dept-stats-grid">
            {% for dept_name, count in dept_distribution.items %}
            <div class="dept-stat">
                <div class="dept-name">{{ dept_name }}</div>
                <div class="dept-count">{{ count }} –Ω–∞—Ä—è–¥–æ–≤</div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    {% else %}
    <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
    <div class="empty-state">
        <div class="empty-icon">üì≠</div>
        <h3>–ù–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –Ω–∞—Ä—è–¥–æ–≤</h3>
        <p>–ù–∞ {{ current_date|date:"F Y" }} –¥–ª—è —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –Ω–∞—Ä—è–¥–æ–≤</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_script %}
<script src="{% static 'js/faculty_academic_duties.js' %}"></script>
{% endblock %}